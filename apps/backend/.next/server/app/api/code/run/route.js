"use strict";(()=>{var e={};e.id=537,e.ids=[537],e.modules={3524:e=>{e.exports=require("@prisma/client")},517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},6113:e=>{e.exports=require("crypto")},2062:(e,r,t)=>{t.r(r),t.d(r,{headerHooks:()=>O,originalPathname:()=>_,requestAsyncStorage:()=>C,routeModule:()=>y,serverHooks:()=>R,staticGenerationAsyncStorage:()=>D,staticGenerationBailout:()=>$});var a={};t.r(a),t.d(a,{POST:()=>POST}),t(4388);var n=t(5789),i=t(4902),o=t(3002),s=t(3387),c=t(4443),l=t(5062);let u=require("child_process"),d=require("util");var p=t.n(d),k=t(6411);let f=require("fs");var m=t.n(f);let S=p().promisify(u.exec);async function buildDockerImage(e,r,t){let{stdout:a,stderr:n}=await S(`docker build -t ${t} -f ${e}dockerfiles/${r}.Dockerfile .`);return{stdout:a,stderr:n}}async function runDockerContainer(e,r){let{stdout:t,stderr:a}=await S(`docker run --name ${e} ${e} bash -c "node ${r}.js"`);return{stdout:t,stderr:a}}async function deleteDockerContainer(e){let{stdout:r,stderr:t}=await S(`docker rm ${e}`);return{stdout:r,stderr:t}}async function deleteDockerImage(e){let{stdout:r,stderr:t}=await S(`docker rmi ${e}`);return{stdout:r,stderr:t}}let g={saveCodeToFile:function(e,r,t){m().writeFileSync(`${e}dockerfiles/${r}.js`,t.toString())},createDockerfile:function(e,r){m().writeFileSync(`${e}dockerfiles/${r}.Dockerfile`,`
  FROM node:14
  WORKDIR /app
  COPY dockerfiles/${r}.js .
  `)},buildDockerImage,runDockerContainer,deleteFiles:function(e,r){m().unlinkSync(`${e}dockerfiles/${r}.js`),m().unlinkSync(`${e}dockerfiles/${r}.Dockerfile`)},deleteDockerImage,deleteDockerContainer};p().promisify(u.exec);let w=new o.PrismaClient;async function POST(e){try{let{code:r,questionId:t}=await e.json(),a=__dirname.split(".next")[0],n=e.headers.get("userId"),i=await w.qa.findFirst({where:{id:parseInt(t)}});if(!i)return(0,c.r)({message:s.Z.ERROR,payload:{error:"Question not found"},status:l.Z.BAD_REQUEST});let o=await Promise.all(JSON.parse(i.testCases).flatMap(async(e,t)=>{let n=(0,k.Z)(),o=(0,k.Z)();g.saveCodeToFile(a,n,r.replace("testSample",JSON.stringify(e))),g.createDockerfile(a,n),await g.buildDockerImage(a,n,o);let{stdout:s}=await g.runDockerContainer(o,n);return await g.deleteDockerContainer(o),await g.deleteDockerImage(o),g.deleteFiles(a,n),{in:JSON.stringify(e),out:s,answer:JSON.parse(i.answer)[t]}}));return await w.run.create({data:{userId:parseInt(n),createdAt:new Date}}),(0,c.r)({message:s.Z.SUCCESS,payload:{output:o},status:l.Z.OK})}catch(e){return console.error(`Error: ${e.message}`),(0,c.r)({message:s.Z.ERROR,payload:{error:e.toString()},status:l.Z.BAD_REQUEST})}}let y=new n.AppRouteRouteModule({definition:{kind:i.x.APP_ROUTE,page:"/api/code/run/route",pathname:"/api/code/run",filename:"route",bundlePath:"app/api/code/run/route"},resolvedPagePath:"C:\\Users\\91882\\Desktop\\slash\\apps\\backend\\app\\api\\code\\run\\route.ts",nextConfigOutput:"",userland:a}),{requestAsyncStorage:C,staticGenerationAsyncStorage:D,serverHooks:R,headerHooks:O,staticGenerationBailout:$}=y,_="/api/code/run/route"},3002:(e,r,t)=>{var a=t(3524);t.o(a,"PrismaClient")&&t.d(r,{PrismaClient:function(){return a.PrismaClient}})},3387:(e,r,t)=>{t.d(r,{Z:()=>a});let a={SUCCESS:"success",ERROR:"error"}},4443:(e,r,t)=>{t.d(r,{r:()=>createResponse});var a=t(3387),n=t(5062);let createResponse=e=>Response.json({message:e.message||a.Z.SUCCESS,payload:e.payload||{}},{status:e.status||n.Z.OK})},5062:(e,r,t)=>{t.d(r,{Z:()=>a});let a={OK:200,BAD_REQUEST:400}}};var r=require("../../../../webpack-runtime.js");r.C(e);var __webpack_exec__=e=>r(r.s=e),t=r.X(0,[701,411],()=>__webpack_exec__(2062));module.exports=t})();